<!DOCTYPE html>
<html lang="en">

<head>
    <title>WebGL - Alessio Troffei</title>

    <!-- Meta info -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">

    <!-- FavIcon-->
    <link rel="icon" type="image/x-icon" href="./assets/icons/favicon.png">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- ------- -->
    <!-- Shaders -->
    <!-- ------- -->

    <!-- Vertex shader -->
    <script id="3d-vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_position;
        attribute vec3 a_normal;
        attribute vec2 a_texcoord;

        uniform mat4 u_projection;
        uniform mat4 u_view;
        uniform mat4 u_world;
        uniform vec3 u_viewWorldPosition;

        varying vec3 v_normal;
        varying vec3 v_surfaceToView;
        varying vec2 v_texcoord;

        void main() {
            vec4 worldPosition = u_world * a_position;
            gl_Position = u_projection * u_view * worldPosition;
            v_surfaceToView = u_viewWorldPosition - worldPosition.xyz;
            v_normal = mat3(u_world) * a_normal;
            v_texcoord = a_texcoord;
        }
    </script>

    <!-- Fragment shader -->
    <script id="3d-fragment-shader" type="x-shader/x-fragment">
        precision highp float;

        varying vec3 v_normal;
        varying vec3 v_surfaceToView;
        varying vec2 v_texcoord;

        uniform vec3 diffuse;
        uniform vec3 ambient;
        uniform vec3 emissive;
        uniform vec3 specular;
        uniform float shininess;
        uniform float opacity;
        uniform vec3 u_lightDirection;
        uniform vec3 u_ambientLight;
        uniform vec3 u_colorLight;
        uniform sampler2D diffuseMap;
        uniform float uAlpha; // Aggiunta

        void main () {
            vec3 normal = normalize(v_normal);

            vec3 surfaceToViewDirection = normalize(v_surfaceToView);
            vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);

            float fakeLight = dot(u_lightDirection, normal) * .5 + .5;
            float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);

            vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);
            vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb * u_colorLight.rgb;
            float effectiveOpacity = opacity * diffuseMapColor.a;

            gl_FragColor = vec4(
                emissive +
                ambient * u_ambientLight +
                effectiveDiffuse * fakeLight +
                specular * pow(specularLight, shininess),
                uAlpha * effectiveOpacity // Aggiunta
            );
        }
    </script>

    <!-- SKYBOX SHADERS -->
    <script id="skybox-vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_position;
        
        varying vec4 v_position;
        
        void main() {
            v_position = a_position;  
            gl_Position = a_position;
            gl_Position.z = 1.0;
        }
    </script>

    <script id="skybox-fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        
        uniform samplerCube u_skybox;
        uniform mat4 u_viewDirectionProjectionInverse; // ???
        
        varying vec4 v_position;
        
        void main() {
            vec4 t = u_viewDirectionProjectionInverse * v_position;
            gl_FragColor = textureCube(u_skybox, normalize(t.xyz/t.w));
        }
    </script>

</head>

<body>

    <!-- Noscript section -->
    <noscript>
        <div>
            <h2>JavaScript è disabilitato!</h2>
            <p>Abilita JavaScript per visualizzare il contenuto della pagina.</p>
        </div>
    </noscript>

    <canvas id="gl-canvas" width="1280px" height="720px"></canvas>
    
    <div id="settings">
        <h1>Computer Graphics</h1>

        <p>Progetto di Alessio Troffei</a>. </p>

        <h2>Paesaggio</h2>
        <ul>
        
            <form id="settingsForm">
                
                Numero di Scheletri: <br>
                <label for="minSkeletonNumber">Min:</label>
                <input type="range" id="minSkeletonNumber" name="minSkeletonNumber" min="1" max="10" value="2"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>5</output><br><br>
                <label for="maxSkeletonNumber">Max:</label>
                <input type="range" id="maxSkeletonNumber" name="maxSkeletonNumber" min="10" max="20" value="10"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>10</output><br><br>

                Numero di Fantasmi: <br>
                <label for="minGhostNumber">Min:</label>
                <input type="range" id="minGhostNumber" name="minGhostNumber" min="1" max="10" value="2"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>5</output><br><br>
                <label for="maxGhostNumber">Max:</label>
                <input type="range" id="maxGhostNumber" name="maxGhostNumber" min="10" max="20" value="10"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>10</output><br><br>
                
                Numero di Tombe: <br>
                <label for="minTombstoneNumber">Min:</label>
                <input type="range" id="minTombstoneNumber" name="minTombstoneNumber" min="1" max="15" value="5"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>10</output><br><br>
                <label for="maxTombstoneNumber">Max:</label>
                <input type="range" id="maxTombstoneNumber" name="maxTombstoneNumber" min="15" max="20" value="15"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>15</output><br><br>

                Numero di Alberi: <br>
                <label for="minTreeNumber">Min:</label>
                <input type="range" id="minTreeNumber" name="minTreeNumber" min="1" max="10" value="5"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>5</output><br><br>
                <label for="maxTreeNumber">Max:</label>
                <input type="range" id="maxTreeNumber" name="maxTreeNumber" min="10" max="15" value="10"  step="1" oninput="this.nextElementSibling.value = this.value">
                <output>10</output><br><br>
                

                <button type="button" onclick="processLandscapeSettings()">Applica</button>
            </form>
        
        </ul>

    </div>


    <div id="bottom-container">

        <div id="graphics">
            <h2>Grafica</h2>

            <label for="ambientLightColorPicker">Ambient Light:</label> 
            <input type="color" id="ambientLightColorPicker" value="#0D0D1A" /> <br>

            <label for="directionalLightColorPicker">Directional Light:</label> 
            <input type="color" id="directionalLightColorPicker" value="#99B3E6" /> <br>

            <label for="directionalLightX">Light Direction X</label>
            <input type="range" id="directionalLightX" min="-1" max="1" step="0.01" value="0.5" oninput="this.nextElementSibling.value = this.value"/> 
            <output>0.5</output> <br>

            <label for="directionalLightY">Light Direction Y</label>
            <input type="range" id="directionalLightY" min="-1" max="1" step="0.01" value="-1" oninput="this.nextElementSibling.value = this.value"/> 
            <output>-1</output> <br>

            <label for="directionalLightZ">Light Direction Z</label>
            <input type="range" id="directionalLightZ" min="-1" max="1" step="0.01" value="0.5" oninput="this.nextElementSibling.value = this.value"/> 
            <output>0.5</output> <br>

        </div>

        <div id="camera">
            <h2>Camera</h2>
            <label for="cameraFov">FOV:</label>
            <input type="range" id="cameraFov" name="cameraFov" min="30" max="120" value="60"  step="1" oninput="this.nextElementSibling.value = this.value">
            <output>60</output><br><br>
        </div>

        <div id="commands">
            <h2>Comandi</h2>
            <ul>
                <li><b>W/S:</b> movimento avanti/indietro</li>
                <li><b>A/D:</b> movimento destra/sinistra</li>
                <li><b>Q/E:</b> spostamento su/giù</li>
                <li><b>Freccia su/giù: </b> inclinazione camera su/giù</li>
                <li><b>Freccia destra/sinistra:</b> rotazione camera</li>
                <li><b>R:</b> reset camera</li>
            </ul>
        </div>

  

    </div>


</body>

<!-- Utility -->
<script src="./js/libs/dat.gui.js"></script>
<script src="./js/libs/glm_utils.js"></script>
<script src="./js/libs/jquery-3.6.0.js"></script>
<script src="./js/libs/load_mesh.js"></script>
<script src="./js/libs/m4.js"></script>
<script src="./js/libs/mesh_utils.js"></script>
<script src="./js/libs/webgl-utils.js"></script>

<!-- Script principali -->
<script src="./js/settings.js"></script>
<script src="./js/camera.js"></script>
<script src="./js/skybox.js"></script>
<script src="./js/model.js"></script>
<script src="./js/utils.js"></script>
<script src="./js/controls.js"></script>
<script src="./js/main.js"></script>

</html>
